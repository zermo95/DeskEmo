<template id="report-template">
    <!-- Page header -->
    <div class="page-header">
        <div class="page-header-content">
            <div class="page-title">
                <h4>
                    <i class="icon-arrow-left52 position-left"></i>
                    <span class="text-semibold">Report</span></h4>
            </div>
        </div>
   </div>
    <!-- /page header -->


    <!-- Content area -->
    <div class="content">

        <!-- Basic datatable -->
        <div class="panel panel-flat">
            <div class="panel-heading">
            </div>

            <div class="panel-body">
                In questa sezione saranno mostrati i report inoltrati dai Vs. pazienti.
<!-- Script per la scansione di tutte le directory e sub-directory contenute nella cartella email -->
<script>
const folder = './email/';
const fs = require('fs');
var addressDir = new Array();
var readEmail = new Array();
var unreadEmail = new Array();
var i = 0;
var z = 0;
//Memorizza i percorsi delle directory contenute nella directory email, nell'array addressDir
fs.readdirSync(folder).forEach(file => {
    addressDir[i] = folder + file + "/";
    i++;
});

//Memorizza i percorsi delle directory delle singole email lette e non lette in due array distinti
var j = 0;
var k = 0;
for(z = 0; z < addressDir.length; z++){
    var newFolder = addressDir[z];
    fs.readdirSync(newFolder).forEach(file => {
        if (fs.existsSync(newFolder + file + "/read.txt")) {
            readEmail[k] = newFolder + file + "/";
            k++;
                        }
    else {
        unreadEmail[j] = newFolder+ file + "/";
            j++;
    }
});

}

//Riempi la datatable report con le email non ancora lette
for ( var i = 0; i < unreadEmail.length; i++){
    var emailInfo = fs.readFileSync(unreadEmail[i]+'emailInfo.txt','utf8');
    var paziente = emailInfo.match("FROM:(.*) <");
    var emailAddress = emailInfo.match("<(.*)>");
    var info = emailInfo.match("BODY:(.*)\n");

    $('#report > tbody:last-child').append('<tr><td>'+paziente[1]+'</td><td>'+emailAddress[1]+'</td><td>'+info[1]+'</td><td><span class="label label-success">Nuova</span></td><td class="text-center"><button type="button" class="btn legitRipple"><i class="icon-enlarge7 position-left"></i> Visualizza</button></td></tr>');

}

//Riempi la datatable report con le email gi√† lette
for ( var i = 0; i < readEmail.length; i++){
    var emailInfo = fs.readFileSync(readEmail[i]+'emailInfo.txt','utf8');
    var paziente = emailInfo.match("FROM:(.*) <");
    var emailAddress = emailInfo.match("<(.*)>");
    var info = emailInfo.match("BODY:(.*)\n");
    
    $('#report > tbody:last-child').append('<tr><td>'+paziente[1]+'</td><td>'+emailAddress[1]+'</td><td>'+info[1]+'</td><td><span class="label label-default">Letta</span></td><td class="text-center"><button type="button" class="btn legitRipple"><i class="icon-enlarge7 position-left"></i> Visualizza</button></td></tr>');

}

</script>

            </div>

            <table class="table datatable-basic" id="report">
                <thead>
                    <tr>
                        <th>Paziente</th>
                        <th>Indirizzo e-mail</th>
                        <th>Informazioni</th>
                        <th>Stato</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
 
                   
                </tbody>
            </table>
        </div>
        <!-- /basic datatable -->
    </div>
    <!-- /content area -->
    <script type="text/javascript" src="assets/js/pages/datatables_basic.js"></script>
    <script type="text/javascript" src="assets/js/core/app.js"></script>    
</template>